name: Marketplace
sid: com.mesg.marketplace.tasks
description: ""
configuration:
  env:
    - PROVIDER_ENDPOINT=https://ropsten.infura.io/v3/6115ae2531f64c04a9a392cf500e5fbe
    - TIMEOUT=30000
    - MARKETPLACE_ADDRESS=0xeCC1A867F871323350A1A89FcAf69629a2d5085e
    - TOKEN_ADDRESS=0x5861b3dc52339d4f976b7fa5d80db6cd6f477f1b
    - IPFS_PROVIDER=ipfs.app.mesg.com
tasks:
  listServices:
    inputs:
    outputs:
      success:
        data:
          services: &services
            type: Object
            repeated: true
            object: &service
              sid: &sid
                type: String
              createTime: &createTime
                type: String
              owner: &owner
                type: String
      error: &outputError
        name: "Error"
        description: "Output when an error occurs"
        data:
          message:
            name: "Message"
            description: "The error message"
            type: String
          code:
            name: "Error code"
            description: "The error code"
            type: String
            optional: true
  getService:
    inputs:
      sid: *sid
    outputs:
      error: *outputError
      success:
        data:
          <<: *service
          offers: &offers
            type: Object
            repeated: true
            optional: true
            object: &offer
              offerIndex: &offerIndex
                type: String
              price: &price
                type: String
              duration: &duration
                type: String
              active:
                type: Boolean
              createTime: *createTime
          purchases: &purchases
            type: Object
            repeated: true
            optional: true
            object: &purchase
              purchaser: &purchaser
                type: String
              expire: &expire
                type: String
              createTime: *createTime
          versions: &versions
            type: Object
            repeated: true
            optional: true
            object: &version
              versionHash: &versionHash
                type: String
              manifest: &manifest
                type: String
              manifestProtocol: &manifestProtocol
                type: String
              createTime: *createTime
              manifestData: &manifestData
                type: Object
                optional: true
                object:
                  version:
                    type: String
                  service: &manifestServiceData
                    type: Object
                    object:
                      deployment:
                        type: Object
                        object:
                          type:
                            type: String
                          source:
                            type: String
                      definition:
                        type: Object
                        object:
                          hash:
                            type: String
                          sid:
                            type: String
                          name:
                            type: String
                          description:
                            type: String
                            optional: true
                          tasks:
                            type: Object
                            repeated: true
                            optional: true
                            object:
                              key:
                                type: String
                              name:
                                type: String
                                optional: true
                              description:
                                type: String
                                optional: true
                              inputs: &manifestServiceDataParameters
                                type: Object
                                optional: true
                                repeated: true
                                object:
                                  key:
                                    type: String
                                  name:
                                    type: String
                                    optional: true
                                  description:
                                    type: String
                                    optional: true
                                  type:
                                    type: String
                                  optional:
                                    type: Boolean
                                    optional: true
                                  repeated:
                                    type: Boolean
                                    optional: true
                                  object:
                                    type: Object
                                    optional: true
                              outputs:
                                type: Object
                                repeated: true
                                object:
                                  key:
                                    type: String
                                  name:
                                    type: String
                                    optional: true
                                  description:
                                    type: String
                                    optional: true
                                  data: *manifestServiceDataParameters
                          events:
                            type: Object
                            repeated: true
                            optional: true
                            object:
                              key:
                                type: String
                              name:
                                type: String
                                optional: true
                              description:
                                type: String
                                optional: true
                              data: *manifestServiceDataParameters
                          configuration:
                            type: Object
                            optional: true
                            object: &manifestServiceDataConfiguration
                              volumes:
                                type: String
                                repeated: true
                                optional: true
                              volumesFrom:
                                type: String
                                repeated: true
                                optional: true
                              ports:
                                type: String
                                repeated: true
                                optional: true
                              args:
                                type: String
                                repeated: true
                                optional: true
                              command:
                                type: String
                                optional: true
                          dependencies:
                            type: Object
                            repeated: true
                            optional: true
                            object:
                              <<: *manifestServiceDataConfiguration
                              key:
                                type: String
                              image:
                                type: String
                          repository:
                            type: String
                            optional: true
                      readme:
                        type: String
                        optional: true
  preparePublishServiceVersion:
    inputs:
      service: *manifestServiceData
      from: &inputFrom
        type: String
      gas: &inputGas
        type: Number
        optional: true
      gasPrice: &inputGasPrice
        type: String
        optional: true
    outputs:
      error: *outputError
      success: &outputTransaction
        data: &transaction
          chainID:
            name: "Chain ID"
            description: "The ID of the chain the transaction is for. See https://github.com/ethereum/EIPs/blob/master/EIPS/eip-155.md#list-of-chain-ids."
            type: Number
          nonce:
            name: "Nonce"
            description: "Nonce to use."
            type: Number
          to:
            name: "To"
            description: "The to address."
            type: String
          value:
            name: "Value"
            description: "The value in Wei."
            type: String
          gas:
            name: "Gas"
            description: "The maximum gas to use to execute this transaction"
            type: Number
          gasPrice:
            name: "Gas price"
            description: "The gas price in Wei."
            type: String
          data:
            name: "Data"
            description: "The data of the transaction."
            type: String
  publishPublishServiceVersion:
    inputs:
      signedTransaction: &signedTransaction
        type: String
    outputs:
      error: *outputError
      success:
        data:
          sid: *sid
          versionHash: *versionHash
          manifest: *manifest
          manifestProtocol: *manifestProtocol
  prepareCreateServiceOffer:
    inputs:
      sid: *sid
      price: *price
      duration: *duration
      from: *inputFrom
      gas: *inputGas
      gasPrice: *inputGasPrice
    outputs:
      error: *outputError
      success: *outputTransaction
  publishCreateServiceOffer:
    inputs:
      signedTransaction: *signedTransaction
    outputs:
      error: *outputError
      success:
        data:
          sid: *sid
          offerIndex: *offerIndex
          price: *price
          duration: *duration
  preparePurchase:
    inputs:
      sid: *sid
      offerIndex: *offerIndex
      from: *inputFrom
      gas: *inputGas
      gasPrice: *inputGasPrice
    outputs:
      error: *outputError
      success:
        data:
          transactions:
            repeated: true
            type: Object
            object: *transaction
  publishPurchase:
    inputs:
      signedTransactions:
        <<: *signedTransaction
        repeated: true
    outputs:
      error: *outputError
      success:
        data:
          sid: *sid
          offerIndex: *offerIndex
          purchaser: *purchaser
          price: *price
          duration: *duration
          expire: *expire
  isAuthorized:
    inputs:
      sid:
        <<: *sid
        optional: true
      versionHash:
        <<: *versionHash
        optional: true
      addresses:
        repeated: true
        type: String
    outputs:
      error: *outputError
      success:
        data:
          authorized:
            type: Boolean
          sid: *sid
          source:
            type: String
            optional: true
          type:
            type: String
            optional: true
